{% extends 'layout.html' %}

{% block body %}

<body class="bg-primary font-lato">
    <!-- Registration Section -->
    <section class="min-h-screen bg-grey from-primary via-secondary to-surface py-12">
        <div class="max-w-md mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Registration Card -->
            <div class="bg-primary rounded-xl shadow-card-hover p-8">
                <!-- Header -->
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-accent/10 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                    </div>
                    <h1 class="text-2xl md:text-3xl font-montserrat font-bold text-text-primary mb-2">
                        Criar Conta
                    </h1>
                    <p class="text-text-secondary">
                        Junte-se aos profissionais que transformam dados em decisões estratégicas
                    </p>
                </div>

                <!-- Registration Form -->
                <form id="registration-form" class="space-y-6">
                    <!-- Full Name Field -->
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-text-primary mb-2">
                            Nome Completo *
                        </label>
                        <input type="text" 
                               id="fullName" 
                               name="fullName" 
                               required
                               class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary"
                               placeholder="Digite seu nome completo">
                        <div id="fullName-error" class="text-error text-sm mt-1 hidden"></div>
                    </div>

                    <!-- Email Field -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-text-primary mb-2">
                            E-mail Corporativo *
                        </label>
                        <input type="email" 
                               id="email" 
                               name="email" 
                               required
                               class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary"
                               placeholder="seu.email@empresa.com.br">
                        <div id="email-error" class="text-error text-sm mt-1 hidden"></div>
                        <div id="email-success" class="text-success text-sm mt-1 hidden">
                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            E-mail disponível
                        </div>
                    </div>

                    <!-- Company Name Field -->
                    <div>
                        <label for="companyName" class="block text-sm font-medium text-text-primary mb-2">
                            Nome da Empresa *
                        </label>
                        <input type="text" 
                               id="companyName" 
                               name="companyName" 
                               required
                               class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary"
                               placeholder="Nome da sua empresa">
                        <div id="companyName-error" class="text-error text-sm mt-1 hidden"></div>
                    </div>

                    <!-- Role Selection -->
                    <div>
                        <label for="role" class="block text-sm font-medium text-text-primary mb-2">
                            Função na Empresa *
                        </label>
                        <select id="role" 
                                name="role" 
                                required
                                class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary">
                            <option value="">Selecione sua função</option>
                            <option value="brand-manager">Gerente de Marca</option>
                            <option value="business-owner">Proprietário/Sócio</option>
                            <option value="data-analyst">Analista de Dados</option>
                            <option value="marketing-manager">Gerente de Marketing</option>
                            <option value="product-manager">Gerente de Produto</option>
                            <option value="sales-manager">Gerente de Vendas</option>
                            <option value="other">Outro</option>
                        </select>
                        <div id="role-error" class="text-error text-sm mt-1 hidden"></div>
                    </div>

                    <!-- Phone Number (Optional) -->
                    <div>
                        <label for="phone" class="block text-sm font-medium text-text-primary mb-2">
                            Telefone (Opcional)
                        </label>
                        <input type="tel" 
                               id="phone" 
                               name="phone"
                               class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary"
                               placeholder="(11) 99999-9999">
                        <div class="text-text-secondary text-xs mt-1">
                            Formato: (11) 99999-9999
                        </div>
                    </div>

                    <!-- Password Field -->
                    <div>
                        <label for="password" class="block text-sm font-medium text-text-primary mb-2">
                            Senha *
                        </label>
                        <div class="relative">
                            <input type="password" 
                                   id="password" 
                                   name="password" 
                                   required
                                   class="w-full px-4 py-3 pr-12 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary"
                                   placeholder="Crie uma senha segura">
                            <button type="button" 
                                    id="toggle-password"
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary hover:text-accent transition-standard">
                                <svg id="eye-closed" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                                </svg>
                                <svg id="eye-open" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Password Strength Indicator -->
                        <div class="mt-2">
                            <div class="flex space-x-1 mb-2">
                                <div id="strength-1" class="h-1 w-1/4 bg-border rounded-full transition-standard"></div>
                                <div id="strength-2" class="h-1 w-1/4 bg-border rounded-full transition-standard"></div>
                                <div id="strength-3" class="h-1 w-1/4 bg-border rounded-full transition-standard"></div>
                                <div id="strength-4" class="h-1 w-1/4 bg-border rounded-full transition-standard"></div>
                            </div>
                            <div id="password-strength-text" class="text-xs text-text-secondary">
                                A senha deve ter pelo menos 8 caracteres
                            </div>
                        </div>
                        
                        <!-- Password Requirements -->
                        <div class="mt-3 space-y-1">
                            <div id="req-length" class="flex items-center text-xs text-text-secondary">
                                <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                Mínimo 8 caracteres
                            </div>
                            <div id="req-uppercase" class="flex items-center text-xs text-text-secondary">
                                <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                Uma letra maiúscula
                            </div>
                            <div id="req-lowercase" class="flex items-center text-xs text-text-secondary">
                                <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                Uma letra minúscula
                            </div>
                            <div id="req-number" class="flex items-center text-xs text-text-secondary">
                                <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"></circle>
                                </svg>
                                Um número
                            </div>
                        </div>
                    </div>

                    <!-- Confirm Password Field -->
                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-text-primary mb-2">
                            Confirmar Senha *
                        </label>
                        <input type="password" 
                               id="confirmPassword" 
                               name="confirmPassword" 
                               required
                               class="w-full px-4 py-3 border border-border rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-standard text-text-primary bg-primary"
                               placeholder="Confirme sua senha">
                        <div id="confirmPassword-error" class="text-error text-sm mt-1 hidden"></div>
                        <div id="confirmPassword-success" class="text-success text-sm mt-1 hidden">
                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            Senhas coincidem
                        </div>
                    </div>

                    <!-- Terms and Privacy -->
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <input type="checkbox" 
                                   id="terms" 
                                   name="terms" 
                                   required
                                   class="mt-1 h-4 w-4 text-accent focus:ring-accent border-border rounded">
                            <label for="terms" class="ml-3 text-sm text-text-secondary">
                                Aceito os 
                                <a href="javascript:void(0)" class="text-accent hover:underline">Termos de Serviço</a> 
                                e a 
                                <a href="javascript:void(0)" class="text-accent hover:underline">Política de Privacidade</a> *
                            </label>
                        </div>
                        
                        <div class="flex items-start">
                            <input type="checkbox" 
                                   id="newsletter" 
                                   name="newsletter"
                                   class="mt-1 h-4 w-4 text-accent focus:ring-accent border-border rounded">
                            <label for="newsletter" class="ml-3 text-sm text-text-secondary">
                                Desejo receber insights semanais sobre o mercado de suplementos e atualizações da plataforma
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" 
                            id="submit-btn"
                            class="w-full bg-accent text-primary px-6 py-4 rounded-lg font-montserrat font-semibold text-lg hover:bg-blue-500 transition-standard shadow-card hover:shadow-card-hover interactive-element disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="submit-text">Criar Conta</span>
                        <svg id="submit-loading" class="hidden animate-spin -ml-1 mr-3 h-5 w-5 text-primary inline" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </form>

                <!-- Login Link -->
                <div class="mt-8 text-center">
                    <p class="text-text-secondary">
                        Já possui uma conta? 
                        <a href="{{ url_for('login') }}" class="text-accent hover:underline font-medium">
                            Fazer Login
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- JavaScript -->
    <script>
        // Password visibility toggle
        document.getElementById('toggle-password').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const eyeClosed = document.getElementById('eye-closed');
            const eyeOpen = document.getElementById('eye-open');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeClosed.classList.add('hidden');
                eyeOpen.classList.remove('hidden');
            } else {
                passwordInput.type = 'password';
                eyeClosed.classList.remove('hidden');
                eyeOpen.classList.add('hidden');
            }
        });

        // Phone number formatting
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 7) {
                value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            e.target.value = value;
        });

        // Password strength checker
        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /\d/.test(password)
            };

            // Update requirement indicators
            Object.keys(requirements).forEach(req => {
                const element = document.getElementById(`req-${req}`);
                const svg = element.querySelector('svg');
                if (requirements[req]) {
                    element.classList.remove('text-text-secondary');
                    element.classList.add('text-success');
                    svg.innerHTML = '<path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>';
                    strength++;
                } else {
                    element.classList.remove('text-success');
                    element.classList.add('text-text-secondary');
                    svg.innerHTML = '<circle cx="12" cy="12" r="10"></circle>';
                }
            });

            // Update strength bars
            const strengthBars = ['strength-1', 'strength-2', 'strength-3', 'strength-4'];
            const strengthText = document.getElementById('password-strength-text');
            
            strengthBars.forEach((bar, index) => {
                const element = document.getElementById(bar);
                element.classList.remove('bg-error', 'bg-warning', 'bg-success', 'bg-border');
                
                if (index < strength) {
                    if (strength <= 2) {
                        element.classList.add('bg-error');
                    } else if (strength === 3) {
                        element.classList.add('bg-warning');
                    } else {
                        element.classList.add('bg-success');
                    }
                } else {
                    element.classList.add('bg-border');
                }
            });

            // Update strength text
            if (strength === 0) {
                strengthText.textContent = 'A senha deve ter pelo menos 8 caracteres';
                strengthText.className = 'text-xs text-text-secondary';
            } else if (strength <= 2) {
                strengthText.textContent = 'Senha fraca';
                strengthText.className = 'text-xs text-error';
            } else if (strength === 3) {
                strengthText.textContent = 'Senha média';
                strengthText.className = 'text-xs text-warning';
            } else {
                strengthText.textContent = 'Senha forte';
                strengthText.className = 'text-xs text-success';
            }

            return strength;
        }

        // Password input event listener
        document.getElementById('password').addEventListener('input', function(e) {
            checkPasswordStrength(e.target.value);
        });

        // Confirm password validation
        document.getElementById('confirmPassword').addEventListener('input', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = e.target.value;
            const errorDiv = document.getElementById('confirmPassword-error');
            const successDiv = document.getElementById('confirmPassword-success');

            if (confirmPassword && password !== confirmPassword) {
                errorDiv.textContent = 'As senhas não coincidem';
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
                e.target.classList.add('border-error');
            } else if (confirmPassword && password === confirmPassword) {
                errorDiv.classList.add('hidden');
                successDiv.classList.remove('hidden');
                e.target.classList.remove('border-error');
            } else {
                errorDiv.classList.add('hidden');
                successDiv.classList.add('hidden');
                e.target.classList.remove('border-error');
            }
        });

        // Email validation
        document.getElementById('email').addEventListener('blur', function(e) {
            const email = e.target.value;
            const errorDiv = document.getElementById('email-error');
            const successDiv = document.getElementById('email-success');

            if (email) {
                // Simulate email availability check
                setTimeout(() => {
                    if (email.includes('test@')) {
                        errorDiv.textContent = 'Este e-mail já está em uso';
                        errorDiv.classList.remove('hidden');
                        successDiv.classList.add('hidden');
                        e.target.classList.add('border-error');
                    } else {
                        errorDiv.classList.add('hidden');
                        successDiv.classList.remove('hidden');
                        e.target.classList.remove('border-error');
                    }
                }, 500);
            }
        });

        // Form validation
        function validateForm() {
            const form = document.getElementById('registration-form');
            const formData = new FormData(form);
            let isValid = true;
            const errors = {};

            // Required field validation
            const requiredFields = ['fullName', 'email', 'companyName', 'role', 'password', 'confirmPassword'];
            requiredFields.forEach(field => {
                const value = formData.get(field);
                if (!value || value.trim() === '') {
                    errors[field] = 'Este campo é obrigatório';
                    isValid = false;
                }
            });

            // Email format validation
            const email = formData.get('email');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                errors.email = 'Formato de e-mail inválido';
                isValid = false;
            }

            // Password validation
            const password = formData.get('password');
            if (password && checkPasswordStrength(password) < 3) {
                errors.password = 'A senha deve atender aos requisitos mínimos';
                isValid = false;
            }

            // Password confirmation
            const confirmPassword = formData.get('confirmPassword');
            if (password && confirmPassword && password !== confirmPassword) {
                errors.confirmPassword = 'As senhas não coincidem';
                isValid = false;
            }

            // Terms acceptance
            if (!formData.get('terms')) {
                errors.terms = 'Você deve aceitar os termos de serviço';
                isValid = false;
            }

            // Display errors
            Object.keys(errors).forEach(field => {
                const errorDiv = document.getElementById(`${field}-error`);
                const input = document.getElementById(field);
                if (errorDiv) {
                    errorDiv.textContent = errors[field];
                    errorDiv.classList.remove('hidden');
                }
                if (input) {
                    input.classList.add('border-error');
                }
            });

            // Clear previous errors for valid fields
            requiredFields.concat(['terms']).forEach(field => {
                if (!errors[field]) {
                    const errorDiv = document.getElementById(`${field}-error`);
                    const input = document.getElementById(field);
                    if (errorDiv) {
                        errorDiv.classList.add('hidden');
                    }
                    if (input) {
                        input.classList.remove('border-error');
                    }
                }
            });

            return isValid;
        }

        // Form submission
        document.getElementById('registration-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const submitLoading = document.getElementById('submit-loading');

            // Show loading state
            submitBtn.disabled = true;
            submitText.textContent = 'Criando conta...';
            submitLoading.classList.remove('hidden');

            // Simulate registration process
            setTimeout(() => {
                alert('Conta criada com sucesso! Verifique seu e-mail para ativar sua conta.');
                window.location.href = '{{ url_for('login') }}';
            }, 2000);
        });

        // Real-time validation for all inputs
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('blur', function() {
                const errorDiv = document.getElementById(`${this.id}-error`);
                if (this.hasAttribute('required') && !this.value.trim()) {
                    if (errorDiv) {
                        errorDiv.textContent = 'Este campo é obrigatório';
                        errorDiv.classList.remove('hidden');
                    }
                    this.classList.add('border-error');
                } else {
                    if (errorDiv && !errorDiv.textContent.includes('coincidem') && !errorDiv.textContent.includes('uso')) {
                        errorDiv.classList.add('hidden');
                    }
                    this.classList.remove('border-error');
                }
            });
        });
    </script>
</body>

{% endblock %}