{% extends 'layout.html' %}

{% block body %}

<body class="bg-primary font-lato">
    <!-- Dashboard Header -->
    <section class="bg-surface py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-3xl font-montserrat font-bold text-text-primary mb-2">
                        Dashboard de Análise
                    </h1>
                </div>
                <div class="mt-4 md:mt-0 flex flex-col sm:flex-row gap-3">
                    <!-- Download direto do CSV presente no repositório -->
                    <a id="export-data" href="/exportarDados" class="bg-accent text-primary px-4 py-2 rounded-md font-montserrat font-semibold hover:bg-blue-500 transition-standard interactive-element inline-flex items-center">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Exportar Dados (CSV2)
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters Section -->
    <section class="bg-primary py-6 border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Filter Toggle for Mobile -->
            <div class="md:hidden mb-4">
                <button id="filter-toggle" class="w-full bg-surface px-4 py-3 rounded-lg flex items-center justify-between text-text-primary font-medium">
                    <span>Filtros de Busca</span>
                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
            </div>

            <!-- Filter Panel -->
            <div id="filter-panel" class="hidden md:block">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 mb-6">
                    <!-- Category Filter -->
                    <div>
                        <label class="block text-sm font-medium text-text-primary mb-2">Categoria</label>
                        <select id="category-filter" class="w-full px-4 py-2 border border-border rounded-md focus:ring-2 focus:ring-accent focus:border-accent transition-standard">
                            <option value="">Todas as categorias</option>
                            <option value="proteinas">Proteínas</option>
                            <option value="veganos">Veganos</option>
                            <option value="vegetarianos">Vegetarianos</option>
                            <option value="termogenicos">Termogênicos</option>
                            <option value="vitaminas">Vitaminas</option>
                            <option value="clinical">Clinical</option>
                            <option value="aminoacidos">Aminoácidos</option>    
                            <option value="carboidratos">Carboidratos</option>    
                        </select>
                    </div>

                    <!-- Price Range Filter -->
                    <div>
                        <label class="block text-sm font-medium text-text-primary mb-2">Faixa de Preço</label>
                        <select id="price-filter" class="w-full px-4 py-2 border border-border rounded-md focus:ring-2 focus:ring-accent focus:border-accent transition-standard">
                            <option value="">Todos os preços</option>
                            <option value="0-50">R$ 0 - R$ 50</option>
                            <option value="50-100">R$ 50 - R$ 100</option>
                            <option value="100-200">R$ 100 - R$ 200</option>
                            <option value="200+">R$ 200+</option>
                        </select>
                    </div>
                </div>

                <!-- Filter Actions -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="apply-filters" class="bg-accent text-primary px-6 py-2 rounded-md font-montserrat font-semibold hover:bg-blue-500 transition-standard interactive-element">
                        Aplicar Filtros
                    </button>
                    <button id="reset-filters" class="border border-border text-text-secondary px-6 py-2 rounded-md font-montserrat font-semibold hover:bg-surface transition-standard">
                        Limpar Filtros
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Dashboard Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Key Metrics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Products -->
            <div class="bg-surface p-6 rounded-xl shadow-card hover:shadow-card-hover transition-standard">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-text-secondary text-sm font-medium">Total de Produtos</p>
                        <p id="big-total-produtos" class="text-2xl font-montserrat font-bold text-text-primary">0</p>
                    </div>
                    <div class="w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4-8-4m16 0v10l-8 4-8-4V7"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Average Price -->
            <div class="bg-surface p-6 rounded-xl shadow-card hover:shadow-card-hover transition-standard">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-text-secondary text-sm font-medium">Preço Médio</p>
                        <p id="big-preco-medio" class="text-2xl font-montserrat font-bold text-text-primary">R$ 00,00</p>
                    </div>
                    <div class="w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Average Rating -->
            <div class="bg-surface p-6 rounded-xl shadow-card hover:shadow-card-hover transition-standard">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-text-secondary text-sm font-medium">Avaliação Média</p>
                        <p id="big-avaliacao-media" class="text-2xl font-montserrat font-bold text-text-primary">0.0</p>
                    </div>
                    <div class="w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-accent" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Average recommendation -->
            <div class="bg-surface p-6 rounded-xl shadow-card hover:shadow-card-hover transition-standard">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-text-secondary text-sm font-medium">Recomendação Média</p>
                        <p id="big-recomendacao-media" class="text-2xl font-montserrat font-bold text-text-primary">0%</p>
                    </div>
                    <div class="w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Price vs Popularity Chart -->
            <div class="bg-surface p-6 rounded-xl shadow-card">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-montserrat font-semibold text-text-primary">Preço vs Popularidade</h3>
                    <button class="text-text-secondary hover:text-accent transition-standard">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                    </button>
                </div>
                <div id="price-popularity-container" class="h-64 bg-primary rounded-lg flex items-center justify-center border border-border">
                    <canvas id="grafico-preco-percepcao" class="chart-canvas" style="height:100%; width:100%;"></canvas>
                </div>
            </div>

            <!-- Rating Distribution Chart -->
            <div class="bg-surface p-6 rounded-xl shadow-card">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-montserrat font-semibold text-text-primary">Distribuição de Avaliações</h3>
                    <button class="text-text-secondary hover:text-accent transition-standard">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                    </button>
                </div>
                <div id="distribuicao-container" class="h-64 bg-primary rounded-lg flex items-center justify-center border border-border p-4">
                    <canvas id="grafico-distribuicao-avaliacoes" class="chart-canvas" style="height:100%; width:100%;"></canvas>
                </div>
            </div>
            
            <!-- Qualidade vs Volume (novo card) -->
            <div class="bg-surface p-6 rounded-xl shadow-card">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-montserrat font-semibold text-text-primary">Qualidade percebida vs. Volume</h3>
                </div>
                <div class="h-64 bg-primary rounded-lg flex items-center justify-center border border-border">
                    <canvas id="grafico-qualidade-volume" class="chart-canvas" style="height:100%; width:100%;"></canvas>
                </div>
            </div>

            <!-- Comparação entre formatos (novo card) -->
            <div class="bg-surface p-6 rounded-xl shadow-card">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-montserrat font-semibold text-text-primary">Comparação entre formatos</h3>
                </div>
                <div class="h-64 bg-primary rounded-lg flex items-stretch justify-center border border-border p-4 overflow-auto">
                    <div id="div-comparacao-formatos" style="width:100%" class="flex items-stretch justify-center"></div>
                    </div>
            </div>
        </div>
    </main>

    <style>
        canvas.chart-canvas { width: 100% !important; height: 100% !important; display: block; max-width: 100%; }
        #div-comparacao-formatos { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
        .format-box { flex: 0 0 32%; min-width: 240px; box-sizing: border-box; padding: 8px; }
        .format-box svg { height: 56px; }
        @media (max-width: 1024px) { .format-box { flex: 0 0 48%; } }
        @media (max-width: 640px) { .format-box { flex: 0 0 100%; } }
    </style>

    <!-- JavaScript -->
    <script type="text/javascript" src="/static/js/chart.js/chart.min.js"></script>
    <script type="text/javascript" src="/static/js/dashboard.js"></script>
</body>

{% endblock %}